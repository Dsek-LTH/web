<script lang="ts">
  import { preventDefault } from "svelte/legacy";

  import type { Member } from "@prisma/client";
  import AuthorSignature from "$lib/components/socials/AuthorSignature.svelte";
  import * as m from "$paraglide/messages";
  import {
    formatGoingList,
    formatInterestedList,
  } from "$lib/events/pluralization";

  let goingModal: HTMLDialogElement = $state();
  let interestedModal: HTMLDialogElement = $state();
  interface Props {
    interested: Member[];
    going: Member[];
  }

  let { interested, going }: Props = $props();

  let goingText = $derived(formatGoingList(going));

  let interestedText = $derived(formatInterestedList(interested));
</script>

{#if going.length > 0}
  <button
    onclick={preventDefault(() => goingModal.showModal())}
    class="link text-sm opacity-40 hover:opacity-60"
  >
    {goingText}
  </button>
  <dialog id="going_modal" class="modal" bind:this={goingModal}>
    <ul class="modal-box m-1 flex flex-col">
      {#each going as person (person.id)}
        <li>
          <AuthorSignature type="member" member={person} />
        </li>
      {/each}
    </ul>
    <form method="dialog" class="modal-backdrop">
      <button>{m.events_interestedGoing_close()}</button>
    </form>
  </dialog>
{/if}
{#if going.length > 0 && interested.length > 0}
  <br />
{/if}
{#if interested.length > 0}
  <button
    onclick={preventDefault(() => interestedModal.showModal())}
    class="link text-sm opacity-40 hover:opacity-60"
  >
    {interestedText}
  </button>
  <dialog id="interested_modal" class="modal" bind:this={interestedModal}>
    <ul class="modal-box m-1 flex flex-col">
      {#each interested as person (person.id)}
        <li>
          <AuthorSignature type="member" member={person} />
        </li>
      {/each}
    </ul>
    <form method="dialog" class="modal-backdrop">
      <button>{m.events_interestedGoing_close()}</button>
    </form>
  </dialog>
{/if}
